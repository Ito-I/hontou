<!DOCTYPE html>
<html lang="ja">
<head>
  <meta charset="UTF-8">
  <title>ã”ã¿æ‹¾ã„ãƒãƒƒãƒ—</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <link rel="stylesheet" href="https://unpkg.com/leaflet/dist/leaflet.css" />
  <style>


    #map { height: 80vh; width: 100%; }
    #form { padding: 10px; }
    label { display: block; margin-top: 10px; }
  </style>
</head>
<body>
  <h2>ã”ã¿æ‹¾ã„ãƒãƒƒãƒ—</h2>
  <p>åœ°å›³ã‚’ã‚¯ãƒªãƒƒã‚¯ã—ã¦ä½ç½®ã‚’æŒ‡å®šã—ã€æƒ…å ±ã‚’å…¥åŠ›ã—ã¦ãã ã•ã„ã€‚</p>

  <div id="map"></div>
  <div id="form" style="display: none;">
    <form id="trashForm">
      <label>æ™‚é–“å¸¯:
        <select id="timeOfDay" required>
          <option value="">é¸æŠã—ã¦ãã ã•ã„</option>
          <option value="æœ">æœ</option>
          <option value="æ˜¼">æ˜¼</option>
          <option value="å¤œ">å¤œ</option>
        </select>
      </label>
      <label>ã”ã¿ã®ç¨®é¡ï¼ˆè‡ªç”±è¨˜å…¥å¯ï¼‰:
        <input type="text" id="trashType" placeholder="ä¾‹: ç©ºãç¼¶, ãƒšãƒƒãƒˆãƒœãƒˆãƒ«">
      </label>
      <button type="submit">è¨˜éŒ²ã™ã‚‹</button>
    </form>
  </div>

  <script src="https://unpkg.com/leaflet/dist/leaflet.js"></script>
  <script>
    const map = L.map('map').setView([35.0, 135.0], 5);
    let currentLatLng = null;

    L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png', {
      attribution: 'Â© OpenStreetMap contributors'
    }).addTo(map);

    map.on('click', function(e) {
      currentLatLng = e.latlng;
      document.getElementById("form").style.display = "block";
    });

    document.getElementById("trashForm").addEventListener("submit", function(e) {
      e.preventDefault();

      const time = document.getElementById("timeOfDay").value;
      const types = document.getElementById("trashType").value;

      if (!currentLatLng || !time || types.trim() === "") {
        alert("å…¨ã¦ã®é …ç›®ã‚’å…¥åŠ›ã—ã¦ãã ã•ã„");
        return;
      }

      const postData = {
        lat: currentLatLng.lat,
        lng: currentLatLng.lng,
        time: time,
        trash: types
      };

      fetch("https://script.google.com/macros/s/AKfycbx-bK11ljMYw05-xru8r-Mx9egXp0dhCham-7_HQ3XviF5AOF7BvhjFL_6Tf1BsvOUy/exec", {
        method: "POST",
        headers: {
          "Content-Type": "application/json"
        },
        body: JSON.stringify(postData)
      });

      let color = "gray";
      if (time === "æœ") color = "lightblue";
      else if (time === "æ˜¼") color = "orange";
      else if (time === "å¤œ") color = "darkblue";

      const marker = L.circleMarker(currentLatLng, {
        radius: 8,
        color: color,
        fillColor: color,
        fillOpacity: 0.8
      }).addTo(map);

      marker.bindPopup(æ™‚é–“å¸¯: ${time}<br>ã”ã¿ã®ç¨®é¡: ${types}).openPopup();

      document.getElementById("trashForm").reset();
      document.getElementById("form").style.display = "none";
    });

    // ğŸ”½ Googleã‚¹ãƒ—ãƒ¬ãƒƒãƒ‰ã‚·ãƒ¼ãƒˆã‹ã‚‰ãƒ‡ãƒ¼ã‚¿èª­ã¿è¾¼ã‚“ã§ãƒãƒ¼ã‚«ãƒ¼è¡¨ç¤º
    fetch("https://script.google.com/macros/s/AKfycbx-bK11ljMYw05-xru8r-Mx9egXp0dhCham-7_HQ3XviF5AOF7BvhjFL_6Tf1BsvOUy/exec")
      .then(response => response.json())
      .then(data => {
        data.forEach(entry => {
          const lat = parseFloat(entry.lat);
          const lng = parseFloat(entry.lng);
          const time = entry.time;
          const types = entry.trash || entry.types;

          let color = "gray";
          if (time === "æœ") color = "lightblue";
          else if (time === "æ˜¼") color = "orange";
          else if (time === "å¤œ") color = "darkblue";

          const marker = L.circleMarker([lat, lng], {
            radius: 8,
            color: color,
            fillColor: color,
            fillOpacity: 0.8
          }).addTo(map);
          marker.bindPopup(æ™‚é–“å¸¯: ${time}<br>ã”ã¿ã®ç¨®é¡: ${types});
        });
      })
      .catch(error => console.error("ã‚¹ãƒ—ãƒ¬ãƒƒãƒ‰ã‚·ãƒ¼ãƒˆã®èª­ã¿è¾¼ã¿å¤±æ•—:", error));
  </script>
</body>
</html>
ã‚¹ãƒ—ãƒ¬ãƒƒãƒ‰ã‚·ãƒ¼ãƒˆã®ã‚³ãƒ¼ãƒ‰
function myFunction() {
  
}